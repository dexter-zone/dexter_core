name: Build artifacts
on:
  push:
    branches: [ "main" ]

env:
  CARGO_TERM_COLOR: always

# This workflow builds the artifacts for the project in docker and adds them as a new commit to the repository.
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
    - name: Build
      run: |
        docker run --rm -v "$(pwd)":/code \
            --mount type=volume,source="$(basename "$(pwd)")_cache",target=/code/target \
            --mount type=volume,source=registry_cache,target=/usr/local/cargo/registry \
            cosmwasm/workspace-optimizer:0.12.10'
    - name: Commit artifacts
      run: |
        git add artifacts/
        git config --global user.email "github-actions[bot]@users.noreply.github.com"
        git config --global user.name "github-actions[bot]"
        git commit -m "Add artifacts"
        git push
    

